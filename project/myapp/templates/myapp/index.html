{%load static%}

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Portfolio Page</title>
    <meta property="og:title" content="Portfolio Page" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta property="twitter:card" content="summary_large_image" />

    <link rel="stylesheet" type="text/css" href="{% static 'myapp/css/index.css' %}">
    <script src="{% static 'myapp/js/indexScriptsAPI.js' %}"></script>
  </head>
  <body>
    <div>
      <div class="home-container">
        <div data-role="Header" class="home-navbar-container">
          <div class="home-navbar">
            <span class="home-heading">
              <span>Добавить</span>
              <br />
            </span>
            <div class="home-links-container">
              <span>
                <span class="Navbar-Link">Учет</span>
                <br />
              </span>
            </div>
          </div>
        </div>
        <div class="home-section-separator"></div>
        <div class="home-pricing">
          <div class="home-heading-container">
            <h1 class="home-text04">Добавление в учет</h1>
          </div>
          <div class="home-pricing-card-container">
            <div class="home-card">
              <div class="home-card-heading">
                <span class="Section-Heading">Человек</span>
              </div>
              <div class="home-card-middle">
                <input
                  type="text"
                  placeholder="Фамилия"
                  class="home-textinput input"
                  id="last-name"
                />
                <input
                  type="text"
                  placeholder="Имя"
                  class="home-textinput1 input"
                  id="first-name"
                />
                <input
                  type="text"
                  placeholder="Отчество"
                  class="home-textinput2 input"
                  id="middle-name"
                />
                <select id="citySelect" className="home-select">
                  <option value="Option 1">Option 1</option>
                  <option value="Option 2">Option 2</option>
                  <option value="Option 3">Option 3</option>
                </select>
              </div>
              <div class="home-card-content">
                <button onclick="addPerson()" class="home-choose button Anchor">Добавить</button>
              </div>
            </div>
            <div class="home-card1">
              <div class="home-card-heading1">
                <span>
                  <span class="Section-Heading">Вещь</span>
                  <br />
                </span>
              </div>
              <div class="home-card-middle1">
                <input
                  type="text"
                  placeholder="Название"
                  class="home-textinput3 input"
                />
                <input
                  type="text"
                  placeholder="Марка"
                  class="home-textinput4 input"
                />
              </div>
              <div class="home-card-content1">
                <button class="home-choose1 button Anchor">Добавить</button>
              </div>
            </div>
            <div class="home-card2">
              <div class="home-card-heading2">
                <span class="Section-Heading">Учет</span>
              </div>
              <div class="home-card-middle2">
                <input
                  type="text"
                  placeholder="ФИО"
                  class="home-textinput5 input"
                  oninput="searchNames(this.value)"
                />
                <ul id="results"></ul>
                  <input
                    type="text"
                    placeholder="Вещь"
                    class="home-textinput6 input"
                />
                <!-- <div class="home-addItemCount">
                  <span class="home-text-addItemCount">Количество</span>
                  <input
                    type="text"
                    placeholder="Количество"
                    class="home-textinput7 input"
                  />
                </div> -->
                <input
                  type="text"
                  placeholder="Количество"
                  class="home-textinput7 input"
                />
              </div>
              <div class="home-card-content2">
                <button class="home-choose2 button Anchor">Добавить</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
function addPerson() {
  const lastName = document.getElementById('last-name').value;
  const firstName = document.getElementById('first-name').value;
  const middleName = document.getElementById('middle-name').value;
  const selectedCityId = document.getElementById('citySelect').value;

  const personData = {
    last_name: lastName,
    first_name: firstName,
    middle_name: middleName,
    city: selectedCityId
  };

  // Получение CSRF-токена из куки
  const csrfCookie = document.cookie.match(/csrftoken=(.*)/);

  if (csrfCookie) {
    const csrfToken = csrfCookie[1];
    console.log(csrfToken);
    console.log(personData);

    fetch('http://127.0.0.1:8000/api/person/create/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
      },
      body: JSON.stringify(personData),  // Правильное преобразование в JSON
    })
    .then(response => {
      if (response.status === 201 || response.status === 204) {
        console.log('Success: Data Posted Successfully');
        // Дополнительные действия по успешному завершению, например, перенаправление или обновление интерфейса
        window.location.reload(); // обновить страницу
      } else {
        throw new Error('Network response was not ok');
      }
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  } else {
    console.error('CSRF token not found in cookies');
  }
}

    </script>

  </body>
</html>
